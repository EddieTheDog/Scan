<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body { font-family: sans-serif; padding: 30px; }
table { border-collapse: collapse; width: 100%; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
button { margin: 0 5px; }
</style>
</head>
<body>
<h1>Admin Panel - Pending Check-Ins</h1>
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Seat</th>
      <th>QR</th>
      <th>Scanned At</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="list"></tbody>
</table>

<script>
async function loadList() {
  try {
    const res = await fetch("/list");
    const data = await res.json();
    const tbody = document.getElementById("list");
    tbody.innerHTML = "";

    data.forEach(c => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${c.id}</td>
        <td>${c.name}</td>
        <td>${c.seat}</td>
        <td>${c.qr_value}</td>
        <td>${c.scanned_at}</td>
        <td>
          <button onclick="approve(${c.id})">Approve</button>
          <button onclick="decline(${c.id})">Decline</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  } catch(err) { console.error(err); }
}

async function approve(id) {
  await fetch("/approve", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, status: "approved" })
  });
  loadList();
}

async function decline(id) {
  await fetch("/approve", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, status: "declined" })
  });
  loadList();
}

// Auto-refresh every 3 seconds
setInterval(loadList, 3000);
loadList();
</script>
</body>
</html>
