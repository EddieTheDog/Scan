<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body { font-family: sans-serif; padding: 30px; }
table { border-collapse: collapse; width: 100%; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
button { margin: 0 5px; }
textarea { width: 100%; margin: 10px 0; }
</style>
</head>
<body>
<h1>Admin Panel</h1>

<h2>Import Intake Data</h2>
<textarea id="importData" rows="10" placeholder="Paste JSON from intake page"></textarea><br/>
<button onclick="loadData()">Load Data</button>

<h2>Pending Check-Ins</h2>
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Seat</th>
      <th>QR</th>
      <th>Scanned At</th>
      <th>Status</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="list"></tbody>
</table>

<h2>Export Updated Data</h2>
<button onclick="exportData()">Export to JSON</button>
<textarea id="exportData" rows="10"></textarea>

<script>
let checkins = [];

// Load data from intake
function loadData() {
  const raw = document.getElementById("importData").value;
  if(!raw) return alert("Paste JSON data from intake page first!");
  try {
    const data = JSON.parse(raw);
    checkins = data;
    renderTable();
  } catch(e) {
    alert("Invalid JSON");
    console.error(e);
  }
}

// Render table
function renderTable() {
  const tbody = document.getElementById("list");
  tbody.innerHTML = "";

  checkins.forEach(c => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.id}</td>
      <td>${c.name}</td>
      <td>${c.seat}</td>
      <td>${c.qr}</td>
      <td>${c.scannedAt}</td>
      <td>${c.status}</td>
      <td>
        ${c.status === 'pending' ? 
          `<button onclick="approve(${c.id})">Approve</button>
           <button onclick="decline(${c.id})">Decline</button>` : ''}
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// Approve / Decline
function approve(id) {
  const entry = checkins.find(c => c.id === id);
  if(entry) {
    entry.status = "approved";
    entry.approvedAt = new Date().toLocaleString();
    renderTable();
  }
}

function decline(id) {
  const entry = checkins.find(c => c.id === id);
  if(entry) {
    entry.status = "declined";
    entry.approvedAt = new Date().toLocaleString();
    renderTable();
  }
}

// Export updated data
function exportData() {
  document.getElementById("exportData").value = JSON.stringify(checkins, null, 2);
  alert("Data is ready to copy and send!");
}
</script>
</body>
</html>
